digraph CRDT_Architecture {
    rankdir=TB;
    node [shape=box, style=rounded, fontname="Arial"];
    edge [fontname="Arial", fontsize=9];

    // Styling
    graph [bgcolor=white, fontname="Arial"];
    
    // Node definitions with colors
    root [label="crdt (root)", shape=box, style="rounded,filled", fillcolor="#4A90E2", fontcolor=white, fontweight=bold];
    
    // Core foundation packages (no dependencies)
    causal_graph [label="causal_graph", shape=box, style="rounded,filled", fillcolor="#7ED321"];
    fugue [label="fugue", shape=box, style="rounded,filled", fillcolor="#7ED321"];
    parser [label="parser", shape=box, style="rounded,filled", fillcolor="#7ED321"];
    
    // Mid-tier packages (depend on foundation)
    oplog [label="oplog", shape=box, style="rounded,filled", fillcolor="#F5A623"];
    branch [label="branch", shape=box, style="rounded,filled", fillcolor="#F5A623"];
    merge [label="merge", shape=box, style="rounded,filled", fillcolor="#F5A623"];
    
    // High-tier package (depends on mid-tier)
    editor [label="editor", shape=box, style="rounded,filled", fillcolor="#BD10E0"];
    
    // External packages
    cmd [label="cmd", shape=box, style="rounded,filled", fillcolor="#CCCCCC"];
    web [label="web", shape=box, style="rounded,filled", fillcolor="#CCCCCC"];
    
    // Dependencies
    // Root package dependencies
    root -> editor [label="imports"];
    root -> oplog [label="imports"];
    root -> parser [label="imports"];
    
    // Editor dependencies
    editor -> causal_graph [label="imports"];
    editor -> oplog [label="imports"];
    editor -> fugue [label="imports"];
    editor -> merge [label="imports"];
    editor -> parser [label="imports"];
    
    // Oplog dependencies
    oplog -> causal_graph [label="imports"];
    
    // Branch dependencies
    branch -> causal_graph [label="imports"];
    branch -> oplog [label="imports"];
    branch -> fugue [label="imports"];
    
    // Merge dependencies
    merge -> causal_graph [label="imports"];
    merge -> oplog [label="imports"];
    merge -> fugue [label="imports"];
    
    // Legend
    subgraph cluster_legend {
        style=rounded;
        label="Legend";
        fontname="Arial";
        
        legend1 [label="Foundation (No deps)", shape=box, style="rounded,filled", fillcolor="#7ED321"];
        legend2 [label="Mid-tier (Foundation deps)", shape=box, style="rounded,filled", fillcolor="#F5A623"];
        legend3 [label="High-tier (Multi-tier deps)", shape=box, style="rounded,filled", fillcolor="#BD10E0"];
        legend4 [label="Entry point / External", shape=box, style="rounded,filled", fillcolor="#4A90E2", fontcolor=white];
        
        legend1 -> legend2 -> legend3 -> legend4 [style=invis];
    }
    
    // Subgraph for organization
    subgraph cluster_foundation {
        style=rounded;
        label="Foundation Layer";
        fontname="Arial";
        
        causal_graph;
        fugue;
        parser;
    }
    
    subgraph cluster_midtier {
        style=rounded;
        label="Mid-tier Layer";
        fontname="Arial";
        
        oplog;
        branch;
        merge;
    }
}
